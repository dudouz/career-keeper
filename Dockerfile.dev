FROM node:18-alpine

# Install pnpm using corepack (built into Node 18+)
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

WORKDIR /app

# Copy package files
COPY package.json pnpm-lock.yaml ./

# Install dependencies with pnpm (using cache mount for faster rebuilds)
# Clean install to ensure fresh dependencies
RUN --mount=type=cache,id=pnpm,target=/pnpm/store pnpm install --force

# Copy the rest of the application
COPY . .

# Clean any existing build artifacts
RUN rm -rf .next node_modules/.cache

# Expose port 3000
EXPOSE 3000

# Start development server with pnpm
CMD ["pnpm", "dev"]

